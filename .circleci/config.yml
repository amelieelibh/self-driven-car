version: 2
jobs:
  build-job:
    docker:
      - image: google/dart
    steps:
      - checkout
      - run:
          name: "dart circleci firebase"
          command: echo Dart circleci
      - run:
          name: Print the current time
          command: date
      - run: dart --version
      - run: pub get
      - run: dart --version
      - run: pub get
      - run: pub build
      - run: pwd
      - run: ls -a
#      - run: git add build
#      - run: git commit -m 'circleci build'
#      - run: git push origin master
      - persist_to_workspace:
          root: .
          paths: build
      - persist_to_workspace:
          root: .
          paths: package.json
  deploy-job:
    docker:
      - image: circleci/node
    steps:
      - attach_workspace:
          at: build
      - run: node --version
      - run: npm --version
      - run: pwd
      - run: ls -a
      - run: cd ..
      - run: ls -a
      - run: npm install --save-dev firebase-tools
      - run: firebase login --email amelieelibh@gmail.com --password SakurA01
      - run: firebase deploy
workflows:
  version: 2
  build-deploy:
    jobs:
      - build-job
      - deploy-job:
          requires:
            - build-job
          filters:
            branches:
              only: master
              