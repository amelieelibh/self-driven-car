version: 2
jobs:
  build-job:
    working_directory: ~/tmp/project
    docker:
      - image: google/dart
    steps:
      - checkout
      - run: dart --version
      - run: pub get
      - run: dart --version
      - run: pub get
      - run: pub build
      - run: pwd
      - run: ls -a
#      - run: git add -f build
#      - run: git config --global user.email "$US_EMAIL"
#      - run: git config --global user.name "$US_NAME"
#      - run: git commit -m 'circleci build'
#      - run: git push -f origin master
      - persist_to_workspace:
          root: /root/tmp
          paths: project
#      - persist_to_workspace:
#          root: .
#          paths: package.json
  deploy-job:
    working_directory: ~/tmp/project
    docker:
      - image: circleci/node
    steps:
      - attach_workspace:
          at: /tmp/project
#      - checkout
      - run: node --version
      - run: npm --version
      - run: pwd
      - run: ls -a
      - run: ls -a build
      - run: ls -a ..
      - run: npm install --save-dev firebase-tools
      - run: firebase login --email $US_EMAIL --password $US_PASS
      - run: firebase deploy
workflows:
  version: 2
  build-deploy:
    jobs:
      - build-job
      - deploy-job:
          requires:
            - build-job
          filters:
            branches:
              only: master
              